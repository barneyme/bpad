<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>bPad</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: snow;
                min-height: 100vh;
                padding: 20px;
                position: relative;
                overflow-x: hidden;
                transition: background 0.5s linear;
            }

            /* --- Weather Theme Backgrounds --- */
            body.theme-snow {
                background: snow;
            }
            body.theme-sun {
                background: linear-gradient(to bottom, #87ceeb, #f9d71c);
            }
            body.theme-cloud {
                background: #bdc3c7;
            }
            body.theme-rain {
                background: #34495e;
            }
            body.theme-none {
                background: #f0f2f5;
            }

            /* --- Animated Weather Effects --- */
            .weather-effect {
                position: fixed;
                top: -20px;
                user-select: none;
                pointer-events: none;
                z-index: -1;
            }

            .snowflake {
                color: #ddd;
                animation: fall linear infinite;
            }

            @keyframes fall {
                to {
                    transform: translateY(105vh) rotate(360deg);
                }
            }

            .sun-flare {
                color: rgba(255, 255, 0, 0.5);
                animation: pulse linear infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                    opacity: 0.5;
                }
                50% {
                    transform: scale(1.5);
                    opacity: 1;
                }
            }

            .cloud {
                color: #ecf0f1;
                font-size: 50px;
                opacity: 0.7;
                animation: drift linear infinite;
            }

            @keyframes drift {
                from {
                    transform: translateX(-10vw);
                }
                to {
                    transform: translateX(110vw);
                }
            }

            .raindrop {
                color: #7f8c8d;
                animation: drizzle linear infinite;
            }

            @keyframes drizzle {
                to {
                    transform: translateY(105vh);
                }
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                display: flex;
                height: 600px;
            }

            .sidebar {
                width: 280px;
                background: #2c3e50;
                color: white;
                display: flex;
                flex-direction: column;
            }

            .sidebar-header {
                padding: 20px;
                border-bottom: 1px solid #34495e;
            }

            .sidebar-header h1 {
                font-size: 1.3em;
                font-weight: 300;
                margin-bottom: 10px;
            }

            .theme-controls {
                margin-bottom: 15px;
            }
            .theme-controls label {
                display: block;
                margin-bottom: 5px;
                font-size: 0.9em;
                font-weight: 500;
            }
            .theme-controls select {
                width: 100%;
                padding: 8px;
                background: #34495e;
                color: white;
                border: 1px solid #7f8c8d;
                border-radius: 4px;
                cursor: pointer;
            }
            .theme-controls select:focus {
                outline: none;
                border-color: #3498db;
            }

            .new-note-btn {
                background: #3498db;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s ease;
                width: 100%;
            }

            .new-note-btn:hover {
                background: #2980b9;
                transform: translateY(-1px);
            }

            .notes-list {
                flex: 1;
                overflow-y: auto;
                padding: 10px 0;
            }

            .note-item {
                padding: 12px 20px;
                cursor: pointer;
                border-bottom: 1px solid #34495e;
                transition: all 0.2s ease;
                position: relative;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .note-item:hover {
                background: #34495e;
            }

            .note-item.active {
                background: #3498db;
                border-left: 4px solid #2980b9;
            }

            .note-title {
                font-size: 14px;
                font-weight: 500;
                margin-bottom: 4px;
                flex: 1;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .note-preview {
                font-size: 12px;
                color: #bdc3c7;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .note-actions {
                opacity: 0;
                transition: opacity 0.2s ease;
                display: flex;
                gap: 5px;
            }

            .note-item:hover .note-actions {
                opacity: 1;
            }

            .note-action-btn {
                background: none;
                border: none;
                color: #bdc3c7;
                cursor: pointer;
                padding: 4px;
                border-radius: 3px;
                font-size: 12px;
                transition: all 0.2s ease;
            }

            .note-action-btn:hover {
                background: rgba(255, 255, 255, 0.1);
                color: white;
            }

            .main-content {
                flex: 1;
                display: flex;
                flex-direction: column;
            }

            .header {
                background: #ecf0f1;
                padding: 20px;
                border-bottom: 1px solid #bdc3c7;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            .note-title-input {
                font-size: 1.2em;
                font-weight: 500;
                border: none;
                background: none;
                color: #2c3e50;
                outline: none;
                padding: 5px;
                border-radius: 3px;
                transition: background 0.2s ease;
                flex: 1;
                min-width: 200px;
            }

            .note-title-input:focus {
                background: white;
                box-shadow: 0 0 0 2px #3498db;
            }

            .controls {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            .btn {
                background: #3498db;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s ease;
            }

            .btn:hover {
                background: #2980b9;
                transform: translateY(-1px);
            }

            .btn.secondary {
                background: #95a5a6;
            }

            .btn.secondary:hover {
                background: #7f8c8d;
            }

            .btn.danger {
                background: #e74c3c;
            }

            .btn.danger:hover {
                background: #c0392b;
            }

            .editor-container {
                flex: 1;
                position: relative;
            }

            #notepad {
                width: 100%;
                height: 100%;
                border: none;
                outline: none;
                padding: 25px;
                font-family: "Courier New", monospace;
                font-size: 14px;
                line-height: 1.6;
                resize: none;
                background: #fafafa;
                color: #333;
            }

            .status-bar {
                background: #ecf0f1;
                padding: 10px 20px;
                font-size: 12px;
                color: #7f8c8d;
                border-top: 1px solid #bdc3c7;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .file-input {
                display: none;
            }

            .word-count {
                font-weight: 500;
            }

            .empty-state {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                color: #7f8c8d;
                text-align: center;
                padding: 40px;
            }

            .empty-state h2 {
                margin-bottom: 10px;
                color: #95a5a6;
            }

            .toggle-sidebar {
                display: none;
                background: #2c3e50;
                color: white;
                border: none;
                padding: 10px;
                cursor: pointer;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1000;
                border-radius: 5px;
            }

            @media (max-width: 768px) {
                .container {
                    height: calc(100vh - 40px);
                    flex-direction: column;
                }

                .sidebar {
                    width: 100%;
                    height: auto;
                    position: relative;
                    transform: translateY(-100%);
                    transition: transform 0.3s ease;
                }

                .sidebar.open {
                    transform: translateY(0);
                }

                .toggle-sidebar {
                    display: block;
                }

                .main-content {
                    flex: 1;
                }

                .header {
                    padding: 15px;
                }

                .note-title-input {
                    font-size: 1em;
                    min-width: 150px;
                }

                #notepad {
                    padding: 15px;
                    font-size: 16px;
                }
            }
        </style>
    </head>
    <body>
        <button class="toggle-sidebar" onclick="toggleSidebar()">
            ☰ Notes
        </button>

        <div class="container">
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h1>📝 bPad</h1>
                    <div class="theme-controls">
                        <label for="theme-select">Weather</label>
                        <select
                            id="theme-select"
                            onchange="changeTheme(this.value)"
                        >
                            <option value="none">Plain</option>
                            <option value="snow">Snow</option>
                            <option value="sun">Sun</option>
                            <option value="cloud">Cloud</option>
                            <option value="rain">Rain</option>
                        </select>
                    </div>
                    <button class="new-note-btn" onclick="createNewNote()">
                        + New Note
                    </button>
                </div>
                <div class="notes-list" id="notesList"></div>
            </div>

            <div class="main-content">
                <div class="header">
                    <input
                        type="text"
                        class="note-title-input"
                        id="noteTitleInput"
                        placeholder="Untitled Note"
                        onchange="updateNoteTitle()"
                    />
                    <div class="controls">
                        <button
                            class="btn"
                            onclick="document.getElementById('fileInput').click()"
                        >
                            Import
                        </button>
                        <button class="btn" onclick="exportNote()">
                            Export
                        </button>
                        <button class="btn secondary" onclick="duplicateNote()">
                            Duplicate
                        </button>
                        <button
                            class="btn danger"
                            onclick="deleteCurrentNote()"
                        >
                            Delete
                        </button>
                    </div>
                </div>

                <div class="editor-container">
                    <div class="empty-state" id="emptyState">
                        <h2>Welcome to bPad</h2>
                        <p>Create your first note to get started!</p>
                    </div>
                    <textarea
                        id="notepad"
                        placeholder="Start typing your notes here..."
                        style="display: none"
                    ></textarea>
                </div>

                <div class="status-bar">
                    <div id="statusText">Ready</div>
                    <div class="word-count" id="wordCount">
                        Words: 0 | Characters: 0
                    </div>
                </div>
            </div>
        </div>

        <input
            type="file"
            id="fileInput"
            class="file-input"
            accept=".txt"
            onchange="importNote(event)"
        />

        <script>
            let notes = {};
            let currentNoteId = null;
            let noteCounter = 1;

            const notepad = document.getElementById("notepad");
            const noteTitleInput = document.getElementById("noteTitleInput");
            const wordCount = document.getElementById("wordCount");
            const statusText = document.getElementById("statusText");
            const notesList = document.getElementById("notesList");
            const emptyState = document.getElementById("emptyState");

            // Load notes from localStorage
            function loadNotes() {
                const savedNotes = localStorage.getItem("multi-notepad-notes");
                const savedCounter = localStorage.getItem(
                    "multi-notepad-counter",
                );

                if (savedNotes) {
                    notes = JSON.parse(savedNotes);
                    noteCounter = parseInt(savedCounter) || 1;
                    renderNotesList();

                    // Load the first note or last active note
                    const savedActiveNote = localStorage.getItem(
                        "multi-notepad-active",
                    );
                    if (savedActiveNote && notes[savedActiveNote]) {
                        selectNote(savedActiveNote);
                    } else {
                        const noteIds = Object.keys(notes);
                        if (noteIds.length > 0) {
                            selectNote(noteIds[0]);
                        }
                    }
                }
            }

            // Save notes to localStorage
            function saveNotes() {
                localStorage.setItem(
                    "multi-notepad-notes",
                    JSON.stringify(notes),
                );
                localStorage.setItem(
                    "multi-notepad-counter",
                    noteCounter.toString(),
                );
                if (currentNoteId) {
                    localStorage.setItem("multi-notepad-active", currentNoteId);
                }
            }

            // Create a new note
            function createNewNote() {
                const noteId = "note_" + Date.now();
                const title = "Note " + noteCounter++;

                notes[noteId] = {
                    id: noteId,
                    title: title,
                    content: "",
                    created: new Date().toISOString(),
                    modified: new Date().toISOString(),
                };

                saveNotes();
                renderNotesList();
                selectNote(noteId);
                statusText.textContent = "New note created";
            }

            // Select and display a note
            function selectNote(noteId) {
                if (currentNoteId && notes[currentNoteId]) {
                    // Save current note content
                    notes[currentNoteId].content = notepad.value;
                    notes[currentNoteId].modified = new Date().toISOString();
                }

                currentNoteId = noteId;
                const note = notes[noteId];

                if (note) {
                    noteTitleInput.value = note.title;
                    notepad.value = note.content;
                    notepad.style.display = "block";
                    emptyState.style.display = "none";
                    updateWordCount();
                    renderNotesList(); // Update active state
                    statusText.textContent = `Opened "${note.title}"`;
                }
            }

            // Update note title
            function updateNoteTitle() {
                if (currentNoteId && notes[currentNoteId]) {
                    notes[currentNoteId].title =
                        noteTitleInput.value || "Untitled Note";
                    notes[currentNoteId].modified = new Date().toISOString();
                    saveNotes();
                    renderNotesList();
                }
            }

            // Delete current note
            function deleteCurrentNote() {
                if (!currentNoteId) return;

                if (
                    !confirm(
                        `Are you sure you want to delete "${notes[currentNoteId].title}"?`,
                    )
                ) {
                    return;
                }

                delete notes[currentNoteId];

                const remainingNotes = Object.keys(notes);
                if (remainingNotes.length > 0) {
                    selectNote(remainingNotes[0]);
                } else {
                    currentNoteId = null;
                    noteTitleInput.value = "";
                    notepad.value = "";
                    notepad.style.display = "none";
                    emptyState.style.display = "flex";
                    updateWordCount();
                }

                saveNotes();
                renderNotesList();
                statusText.textContent = "Note deleted";
            }

            // Duplicate current note
            function duplicateNote() {
                if (!currentNoteId) return;

                const originalNote = notes[currentNoteId];
                const noteId = "note_" + Date.now();

                notes[noteId] = {
                    id: noteId,
                    title: originalNote.title + " (Copy)",
                    content: originalNote.content,
                    created: new Date().toISOString(),
                    modified: new Date().toISOString(),
                };

                saveNotes();
                renderNotesList();
                selectNote(noteId);
                statusText.textContent = "Note duplicated";
            }

            // Export current note
            function exportNote() {
                if (!currentNoteId) return;

                const note = notes[currentNoteId];
                const blob = new Blob([note.content], { type: "text/plain" });
                const url = URL.createObjectURL(blob);

                const a = document.createElement("a");
                a.href = url;
                a.download = (note.title || "Untitled Note") + ".txt";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                statusText.textContent = "Note exported";
            }

            // Import note from file
            function importNote(event) {
                const file = event.target.files[0];
                if (!file) return;

                if (file.type !== "text/plain") {
                    alert("Please select a text file (.txt)");
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const noteId = "note_" + Date.now();
                    const fileName = file.name.replace(/\.txt$/i, "");

                    notes[noteId] = {
                        id: noteId,
                        title: fileName,
                        content: e.target.result,
                        created: new Date().toISOString(),
                        modified: new Date().toISOString(),
                    };

                    saveNotes();
                    renderNotesList();
                    selectNote(noteId);
                    statusText.textContent = "Note imported successfully";
                };
                reader.readAsText(file);

                // Reset file input
                event.target.value = "";
            }

            // Render the notes list
            function renderNotesList() {
                notesList.innerHTML = "";

                const sortedNotes = Object.values(notes).sort(
                    (a, b) => new Date(b.modified) - new Date(a.modified),
                );

                sortedNotes.forEach((note) => {
                    const noteItem = document.createElement("div");
                    noteItem.className = `note-item ${note.id === currentNoteId ? "active" : ""}`;
                    noteItem.onclick = () => selectNote(note.id);

                    const preview =
                        note.content.substring(0, 50).replace(/\n/g, " ") ||
                        "No content";

                    noteItem.innerHTML = `
                    <div style="flex: 1; min-width: 0;">
                        <div class="note-title">${note.title}</div>
                        <div class="note-preview">${preview}</div>
                    </div>
                    <div class="note-actions">
                        <button class="note-action-btn" onclick="event.stopPropagation(); renameNote('${note.id}')" title="Rename">✏️</button>
                        <button class="note-action-btn" onclick="event.stopPropagation(); deleteNote('${note.id}')" title="Delete">🗑️</button>
                    </div>
                `;

                    notesList.appendChild(noteItem);
                });
            }

            // Rename note
            function renameNote(noteId) {
                const newTitle = prompt(
                    "Enter new title:",
                    notes[noteId].title,
                );
                if (newTitle && newTitle.trim()) {
                    notes[noteId].title = newTitle.trim();
                    notes[noteId].modified = new Date().toISOString();

                    if (noteId === currentNoteId) {
                        noteTitleInput.value = newTitle.trim();
                    }

                    saveNotes();
                    renderNotesList();
                }
            }

            // Delete specific note
            function deleteNote(noteId) {
                if (
                    !confirm(
                        `Are you sure you want to delete "${notes[noteId].title}"?`,
                    )
                ) {
                    return;
                }

                delete notes[noteId];

                if (noteId === currentNoteId) {
                    const remainingNotes = Object.keys(notes);
                    if (remainingNotes.length > 0) {
                        selectNote(remainingNotes[0]);
                    } else {
                        currentNoteId = null;
                        noteTitleInput.value = "";
                        notepad.value = "";
                        notepad.style.display = "none";
                        emptyState.style.display = "flex";
                        updateWordCount();
                    }
                }

                saveNotes();
                renderNotesList();
            }

            // Update word count
            function updateWordCount() {
                const text = notepad.value;
                const words =
                    text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
                const characters = text.length;
                wordCount.textContent = `Words: ${words} | Characters: ${characters}`;
            }

            // Toggle sidebar on mobile
            function toggleSidebar() {
                const sidebar = document.getElementById("sidebar");
                sidebar.classList.toggle("open");
            }

            // Auto-save current note every 2 seconds
            setInterval(() => {
                if (
                    currentNoteId &&
                    notes[currentNoteId] &&
                    notepad.value !== notes[currentNoteId].content
                ) {
                    notes[currentNoteId].content = notepad.value;
                    notes[currentNoteId].modified = new Date().toISOString();
                    saveNotes();
                    renderNotesList();
                }
            }, 2000);

            // Event listeners
            notepad.addEventListener("input", () => {
                updateWordCount();
                if (currentNoteId && notes[currentNoteId]) {
                    notes[currentNoteId].modified = new Date().toISOString();
                }
            });

            // Keyboard shortcuts
            document.addEventListener("keydown", (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case "n":
                            e.preventDefault();
                            createNewNote();
                            break;
                        case "s":
                            e.preventDefault();
                            if (currentNoteId) {
                                exportNote();
                            }
                            break;
                        case "o":
                            e.preventDefault();
                            document.getElementById("fileInput").click();
                            break;
                        case "d":
                            e.preventDefault();
                            if (currentNoteId) {
                                duplicateNote();
                            }
                            break;
                    }
                }
            });

            // --- Weather Theme Functions ---

            function changeTheme(theme) {
                clearThemeElements();
                document.body.className = `theme-${theme}`;

                switch (theme) {
                    case "snow":
                        createSnowflakes();
                        break;
                    case "sun":
                        createSunFlares();
                        break;
                    case "cloud":
                        createClouds();
                        break;
                    case "rain":
                        createRaindrops();
                        break;
                }
                localStorage.setItem("bpad-theme", theme);
            }

            function clearThemeElements() {
                const elements = document.querySelectorAll(".weather-effect");
                elements.forEach((el) => el.remove());
            }

            function createSnowflakes() {
                const snowflakeChars = ["❄", "❅", "❆"];
                const numberOfSnowflakes = 50;
                for (let i = 0; i < numberOfSnowflakes; i++) {
                    const snowflake = document.createElement("div");
                    snowflake.className = "snowflake weather-effect";
                    snowflake.innerHTML =
                        snowflakeChars[
                            Math.floor(Math.random() * snowflakeChars.length)
                        ];
                    snowflake.style.left = Math.random() * 100 + "vw";
                    snowflake.style.fontSize = Math.random() * 10 + 10 + "px";
                    snowflake.style.animationDuration =
                        Math.random() * 5 + 5 + "s";
                    snowflake.style.animationDelay = Math.random() * 5 + "s";
                    snowflake.style.opacity = Math.random() * 0.6 + 0.4;
                    document.body.appendChild(snowflake);
                }
            }

            function createSunFlares() {
                const numberOfFlares = 20;
                for (let i = 0; i < numberOfFlares; i++) {
                    const flare = document.createElement("div");
                    flare.className = "sun-flare weather-effect";
                    flare.innerHTML = "☀️";
                    flare.style.left = Math.random() * 100 + "vw";
                    flare.style.top = Math.random() * 100 + "vh";
                    flare.style.fontSize = Math.random() * 20 + 10 + "px";
                    flare.style.animationDuration = Math.random() * 4 + 2 + "s";
                    flare.style.animationDelay = Math.random() * 4 + "s";
                    document.body.appendChild(flare);
                }
            }

            function createClouds() {
                const numberOfClouds = 15;
                for (let i = 0; i < numberOfClouds; i++) {
                    const cloud = document.createElement("div");
                    cloud.className = "cloud weather-effect";
                    cloud.innerHTML = "☁️";
                    cloud.style.top = Math.random() * 60 + "vh";
                    cloud.style.transform = `scale(${Math.random() * 0.5 + 0.8})`;
                    cloud.style.animationDuration =
                        Math.random() * 30 + 20 + "s";
                    cloud.style.animationDelay = Math.random() * 20 + "s";
                    document.body.appendChild(cloud);
                }
            }

            function createRaindrops() {
                const numberOfDrops = 100;
                for (let i = 0; i < numberOfDrops; i++) {
                    const drop = document.createElement("div");
                    drop.className = "raindrop weather-effect";
                    drop.style.left = Math.random() * 100 + "vw";
                    drop.style.height = Math.random() * 20 + 10 + "px";
                    drop.style.width = "1px";
                    drop.style.backgroundColor = "#7f8c8d";
                    drop.style.animationDuration =
                        Math.random() * 0.5 + 0.5 + "s";
                    drop.style.animationDelay = Math.random() * 2 + "s";
                    drop.style.opacity = Math.random() * 0.5 + 0.3;
                    document.body.appendChild(drop);
                }
            }

            // Initialize the app
            window.addEventListener("load", () => {
                loadNotes();
                if (Object.keys(notes).length === 0) {
                    emptyState.style.display = "flex";
                    notepad.style.display = "none";
                }
                updateWordCount();

                // Load and apply saved theme
                const savedTheme = localStorage.getItem("bpad-theme") || "none";
                document.getElementById("theme-select").value = savedTheme;
                changeTheme(savedTheme);
            });

            // Save before page unload
            window.addEventListener("beforeunload", () => {
                if (currentNoteId && notes[currentNoteId]) {
                    notes[currentNoteId].content = notepad.value;
                    saveNotes();
                }
            });
        </script>
    </body>
</html>
