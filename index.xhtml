<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000000"/>
  <title>bad.me</title>
  <style type="text/css">
    /* Embedded CSS */
    html, body {
      height: 100%; 
      box-sizing: border-box; 
      margin: 0;
    }
    * {
      box-sizing: inherit;
    }
    textarea {
      height: calc(100% - 3rem); /* Adjusted for nav height */
      border: none; 
      outline: none; 
      resize: none;
      font-family: monospace;
      padding: 0.5em;
      width: 100%;
    }
    #textbox {
      border-right: 1px solid PaleTurquoise;
      border-color: darkgray;
      background-color: transparent;
      overflow-y: scroll;
    }
    nav {
      position: fixed; 
      bottom: 0; 
      left: 0;
      width: 100%; 
      height: 2rem; 
      padding: 0 0.5em; /* Adjusted padding */
      background-color: #eee; 
      border-top: 1px solid silver;
      line-height: 2rem;
      color: gray; 
      font-family: sans-serif; 
      font-size: 85%;
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    #controls {
      display: flex; 
      align-items: center; 
    }
    #save a, #open a, #about-icon {
      text-decoration: none;
      margin-left: 0.5em; /* Space between links */
    }
    #open > input {
      display: none;
    }
    #about > form {
      text-align: right;
    }
    #about-icon {
      color: black;
      font-weight: bold;
    }
    @media (max-width: 600px) {
      nav {
        flex-direction: column; /* Stack items on smaller screens */
        height: auto; /* Allow height to adjust */
      }
      #stats {
        margin-bottom: 0.5em; /* Space between stats and controls */
      }
      #controls {
        flex-direction: column; /* Stack controls on smaller screens */
      }
      #controls span {
        margin-bottom: 0.5em; /* Space between control items */
      }
    }
    @media print { 
      nav { display: none; } 
    }
    
    /* Popup styles */
    #readme-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 600px;
      max-height: 80%;
      background: white;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
      font-family: sans-serif;
      border-radius: 5px;
    }
    #readme-popup h2 {
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    #readme-popup strong {
      display: block;
      margin-top: 15px;
      margin-bottom: 5px;
    }
    #readme-content {
      line-height: 1.5;
    }
    #readme-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #666;
    }
    #readme-close:hover {
      color: #000;
    }
    #popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
  </style>
</head>
<body>
  <textarea id="textbox" autofocus="autofocus" placeholder="Welcome to bPad."></textarea>
  <nav>
    <span id="stats">
      <span id="word-count">0</span> W. 
      <span id="line-count">0</span> L.
    </span> 
    <span id="controls">
      <button id="open">^O</button>
      <input id="filename" placeholder="bpad.txt" />
      <button id="save">^S</button>
      <button id="readme-button">?</button>
    </span>
  </nav>
  <input type="file" id="open-input" style="display: none;" />
  
  <!-- Readme Popup -->
  <div id="popup-overlay"></div>
  <div id="readme-popup">
    <button id="readme-close">Ã—</button>
    <h2>Readme</h2>
    <div id="readme-content">
      <strong>ABOUT</strong>
      <p>bPad is a plaintext editor web app created by <a href="https://barney.me">barney</a>.<br/>
      bPad is b(arneys note)Pad but you can use it too.<br/>
      bPad autosaves your notes in your browser, can be used offline, and it works on mobile and desktop browsers.<br/>
      bPad can open, create, and save plaintext files such as .TXT, .CSV, .XML, .MD, .HTML, .CSS, .LOG, .BAT, .VBS, .SH, .PS1, .PY, .PL, .JS, and more.</p>
      
      <strong>DIRECTIONS</strong>
      <p>Open bad.me in web browser and start writing. Notes are automatically saved in your browser.<br/>
      bPad can be used offline after the first use. Simply reopen bPad.me to continue working on your notes.<br/>
      Press CTRL + O or click ^O to edit a file from your computer.<br/>
      Press CTRL + S or click ^S to download your notes to your computer. bPad saves your notes as 'bpad.txt' by default but you can change it to any name and filetype (EG rm-rf.sh.)<br/>
      Click ? to view this Readme file.</p>
      
      <strong>PRIVACY</strong>
      <p>bPad does not (and cannot) see your notes.<br/>
      bPad does not (and cannot) see any activity on your computer.<br/>
      bPad does not (and cannot) judge your music choices while using it.<br/>
      bPad does not (and cannot) track who is using it.<br/>
      Bpad does not (and cannot) sell your data.</p>
    </div>
  </div>
  
  <script type="text/javascript">
    // Main script
    var textbox = document.querySelector('#textbox');
    var timeoutID = null;
    var filenameBox = document.querySelector('#filename');
    
    textbox.value = localStorage.getItem('0wl') || '';
    textbox.setSelectionRange(textbox.value.length, textbox.value.length); 
    calcStats(); 
    
    function storeLocally() { 
        localStorage.setItem('0wl', textbox.value); 
    }
    
    window.onbeforeunload = storeLocally; 
    
    textbox.onkeydown = function (event) {
        if (event.key === "Tab") {
            event.preventDefault();
            var text = this.value, s = this.selectionStart, e = this.selectionEnd;
            this.value = text.substring(0, s) + '\t' + text.substring(e);
            this.selectionStart = this.selectionEnd = s + 1;
        }
    };
    
    window.addEventListener('keydown', function(event) {
        if (event.ctrlKey) {
            if (event.key === 'o') {
                event.preventDefault(); 
                document.querySelector('#open-input').click(); 
            } else if (event.key === 's') {
                event.preventDefault(); 
                document.querySelector('#save').click(); 
            }
        }
    });
    
    textbox.onkeyup = function () {
        calcStats();
        window.clearTimeout(timeoutID);
        timeoutID = window.setTimeout(storeLocally, 1000);
    };
    
    function calcStats() {
        updateCount('word', textbox.value === "" ? 0 : textbox.value.replace(/\s+/g, ' ').split(' ').length);   
        updateCount('line', textbox.value === "" ? 0 : textbox.value.split(/\n/).length);
    }
    
    function updateCount(item, value) {
        document.querySelector('#' + item + '-count').textContent = value;
    }
    
    document.querySelector('#save').onclick = function () {
        var filename = filenameBox.value || '0wl.txt';
        var blob = new Blob([textbox.value], {type: 'text/plain'});
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);
    };
    
    document.querySelector('#open').onclick = function() {
        document.querySelector('#open-input').click();
    };
    
    document.querySelector('#open-input').onchange = function(event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                textbox.value = e.target.result;
                calcStats();
                storeLocally();
                filenameBox.value = file.name;
            };
            reader.readAsText(file);
        }
    };

    // Popup functionality
    document.getElementById('readme-button').onclick = function() {
      document.getElementById('popup-overlay').style.display = 'block';
      document.getElementById('readme-popup').style.display = 'block';
    };
    
    document.getElementById('readme-close').onclick = function() {
      document.getElementById('popup-overlay').style.display = 'none';
      document.getElementById('readme-popup').style.display = 'none';
    };
    
    document.getElementById('popup-overlay').onclick = function() {
      document.getElementById('popup-overlay').style.display = 'none';
      document.getElementById('readme-popup').style.display = 'none';
    };
  </script>
</body>
</html>
