<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000000"/>
  <title>bpad.me</title>
  <!-- Add manifest link -->
  <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiYlBhZCIsInNob3J0X25hbWUiOiJiUGFkIiwiZGVzY3JpcHRpb24iOiJBIHNpbXBsZSBvZmZsaW5lIGNhcGFibGUgdGV4dCBlZGl0b3IiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiMwMDAwMDAiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9icGFkLm1lL2ljb24ucG5nIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=" />
  <!-- Add favicon using inline SVG data URI -->
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YwZjBmMCIgLz48dGV4dCB4PSI1MCIgeT0iNTUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjMzMzIj5iPC90ZXh0Pjwvc3ZnPg==" />
  <style type="text/css">
    /* Embedded CSS */
    html, body {
      height: 100%; 
      box-sizing: border-box; 
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    * {
      box-sizing: inherit;
    }
    textarea {
      height: calc(100% - 3rem); /* Adjusted for nav height */
      border: none; 
      outline: none; 
      resize: none;
      font-family: monospace;
      padding: 0.5em;
      width: 100%;
      font-size: 16px; /* Prevent zoom on mobile when focused */
    }
    #textbox {
      border-right: 1px solid darkgray;
      background-color: transparent;
      overflow-y: scroll;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 3rem; /* Adjusted for nav height */
    }
    nav {
      position: fixed; 
      bottom: 0; 
      left: 0;
      width: 100%; 
      height: auto; /* Allow height to adjust based on content */
      min-height: 3rem; 
      padding: 0.5em; 
      background-color: #eee; 
      border-top: 1px solid silver;
      color: gray; 
      font-size: 100%;
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      flex-wrap: wrap; /* Allow controls to wrap */
    }
    #controls {
      display: flex; 
      align-items: center; 
      flex-wrap: wrap; /* Allow controls to wrap */
      gap: 0.5em; /* Space between controls */
    }
    button {
      padding: 0.5em 0.75em;
      background-color: #f8f8f8;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 0.25em 0;
    }
    button:hover {
      background-color: #e8e8e8;
    }
    #filename {
      padding: 0.5em;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      min-width: 100px;
      max-width: 200px;
    }
    #stats {
      padding: 0.5em 0;
    }
    #open > input {
      display: none;
    }
    
    /* Popup styles */
    #readme-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      background: white;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
      border-radius: 5px;
    }
    #readme-popup h2 {
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    #readme-popup strong {
      display: block;
      margin-top: 15px;
      margin-bottom: 5px;
    }
    #readme-content {
      line-height: 1.5;
    }
    #readme-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #666;
      padding: 0;
      margin: 0;
    }
    #readme-close:hover {
      color: #000;
    }
    #popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    /* Notification styles */
    .notification {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 8px 10px;
      text-align: center;
      font-family: sans-serif;
      font-size: 14px;
      z-index: 1001;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #offline-notification {
      background-color: #f8d7da;
      color: #721c24;
    }
    #online-notification {
      background-color: #d4edda;
      color: #155724;
    }
    #download-notification {
      background-color: #d1ecf1;
      color: #0c5460;
    }
    
    /* Media queries for better responsiveness */
    @media (max-width: 500px) {
      nav {
        flex-direction: column;
        align-items: stretch;
        padding: 0.5em;
      }
      #controls {
        margin-top: 0.5em;
        justify-content: space-between;
      }
      #filename {
        flex-grow: 1;
        max-width: none;
      }
      #textbox {
        bottom: 6rem; /* Adjusted for taller nav on mobile */
      }
      #stats {
        text-align: center;
      }
    }
    
    @media (max-width: 350px) {
      button {
        padding: 0.4em 0.5em;
        font-size: 12px;
      }
      #filename {
        font-size: 12px;
        padding: 0.4em;
      }
    }
    
    @media print { 
      nav, .notification { 
        display: none; 
      } 
      #textbox {
        position: static;
        height: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Notification bars -->
  <div id="offline-notification" class="notification">Offline! Changes will be saved locally.</div>
  <div id="online-notification" class="notification">Online!</div>
  <div id="download-notification" class="notification">File downloaded successfully</div>
  
  <textarea id="textbox" autofocus="autofocus" placeholder="Start typing here to get started or click ? to learn more."></textarea>
  <nav>
    <span id="stats">
      <span id="word-count">0</span> W. 
      <span id="line-count">0</span> L.
    </span> 
    <span id="controls">
      <button id="open">^O</button>
      <input id="filename" placeholder="bpad.txt" />
      <button id="save">^S</button>
      <button id="readme-button">?</button>
    </span>
  </nav>
  <input type="file" id="open-input" style="display: none;" />
  
  <!-- Readme Popup -->
  <div id="popup-overlay"></div>
  <div id="readme-popup">
    <button id="readme-close">Ã—</button>
    <h2>Readme</h2>
    <div id="readme-content">
      <strong>ABOUT</strong>
      <p>bPad is a text editor web app created by <a href="https://barney.me">Barney</a>.<br/>
      bPad is b(arneys note)Pad but you can use it too. :-)<br/>
      bPad automatically saves your notes in your browser, can be used offline, and it works on mobile and desktop browsers.<br/>
      bPad can open, create, and save plaintext files like .TXT, .CSV, .XML, .MD, .HTML, .CSS, .LOG, .BAT, .VBS, .SH, .PS1, .PY, .PL, and .JS.<br/>
      bPad can be used to remove formatting from text by simply pasting in to bPad and copying out again.<br/>
      bPad can be used as a distraction free writing tool to allow you to just focus on the words and nothing else.<br/>
      bPad is designed to be a bare bones basic online text editor and as such is 'feature complete.' If you are looking for more features there are great tools out there like cryptpad.fr.</p>
      
      <strong>DIRECTIONS</strong>
      <p>Open bpad.me in web browser and start writing. Notes are automatically saved in your browser.<br/>
      bPad can be used offline after the first use. Simply reopen bpad.me in your browser to continue working on your notes.<br/>
      Press CTRL + O or click ^O to edit a file from your computer.<br/>
      Press CTRL + S or click ^S to download your notes to your computer. bPad saves your notes as 'bpad.txt' by default but you can change it to any name and filetype (EG rm-rf.sh.)<br/>
      Click ? to view this Readme file.</p>
      
      <strong>PRIVACY</strong>
      <p>bPad.me does not (and cannot) see your notes.<br/>
      bPad.me does not (and cannot) see any activity on your computer.<br/>
      bPad.me does not (and cannot) judge your music choices while using it.<br/>
      bPad.me does not (and cannot) track who you are.<br/>
      bPad.me does not (and cannot) sell your data.</p>
    </div>
  </div>
  
  <script type="text/javascript">
    // Register Service Worker for offline capability
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js').then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
    
    // Online/Offline status handling
    function updateOnlineStatus() {
      const offlineNotification = document.getElementById('offline-notification');
      const onlineNotification = document.getElementById('online-notification');
      
      if (navigator.onLine) {
        offlineNotification.style.display = 'none';
        onlineNotification.style.display = 'block';
        setTimeout(() => {
          onlineNotification.style.display = 'none';
        }, 3000);
      } else {
        offlineNotification.style.display = 'block';
        onlineNotification.style.display = 'none';
      }
    }

    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    // Adjust textarea height on window resize
    function adjustTextareaHeight() {
      const nav = document.querySelector('nav');
      const navHeight = nav.offsetHeight;
      const textbox = document.querySelector('#textbox');
      textbox.style.bottom = navHeight + 'px';
    }
    
    window.addEventListener('resize', adjustTextareaHeight);
    window.addEventListener('load', adjustTextareaHeight);
    
    // Inline ServiceWorker script creation
    const swContent = `
      // Service Worker for bPad
      const CACHE_NAME = 'bpad-cache-v1';
      const urlsToCache = [
        './',
        './index.html'
      ];

      self.addEventListener('install', function(event) {
        event.waitUntil(
          caches.open(CACHE_NAME)
            .then(function(cache) {
              return cache.addAll(urlsToCache);
            })
        );
      });

      self.addEventListener('fetch', function(event) {
        event.respondWith(
          caches.match(event.request)
            .then(function(response) {
              // Cache hit - return response
              if (response) {
                return response;
              }
              return fetch(event.request);
            })
        );
      });
    `;

    // Create the service worker file dynamically
    const blob = new Blob([swContent], {type: 'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    
    // Override the service worker registration to use our blob URL
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register(swUrl).then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
    
    // Main script
    var textbox = document.querySelector('#textbox');
    var timeoutID = null;
    var filenameBox = document.querySelector('#filename');
    
    textbox.value = localStorage.getItem('0wl') || '';
    textbox.setSelectionRange(textbox.value.length, textbox.value.length); 
    calcStats(); 
    
    function storeLocally() { 
        localStorage.setItem('0wl', textbox.value); 
    }
    
    window.onbeforeunload = storeLocally; 
    
    textbox.onkeydown = function (event) {
        if (event.key === "Tab") {
            event.preventDefault();
            var text = this.value, s = this.selectionStart, e = this.selectionEnd;
            this.value = text.substring(0, s) + '\t' + text.substring(e);
            this.selectionStart = this.selectionEnd = s + 1;
        }
    };
    
    window.addEventListener('keydown', function(event) {
        if (event.ctrlKey || event.metaKey) { // Add metaKey for Mac support
            if (event.key === 'o') {
                event.preventDefault(); 
                document.querySelector('#open-input').click(); 
            } else if (event.key === 's') {
                event.preventDefault(); 
                document.querySelector('#save').click(); 
            }
        }
    });
    
    textbox.onkeyup = function () {
        calcStats();
        window.clearTimeout(timeoutID);
        timeoutID = window.setTimeout(storeLocally, 1000);
    };
    
    function calcStats() {
        updateCount('word', textbox.value === "" ? 0 : textbox.value.replace(/\s+/g, ' ').split(' ').length);   
        updateCount('line', textbox.value === "" ? 0 : textbox.value.split(/\n/).length);
    }
    
    function updateCount(item, value) {
        document.querySelector('#' + item + '-count').textContent = value;
    }
    
    document.querySelector('#save').onclick = function () {
        var filename = filenameBox.value || 'bpad.txt';
        var blob = new Blob([textbox.value], {type: 'text/plain'});
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);
        
        // Show download notification
        const downloadNotification = document.getElementById('download-notification');
        downloadNotification.style.display = 'block';
        setTimeout(() => {
            downloadNotification.style.display = 'none';
        }, 3000);
    };
    
    document.querySelector('#open').onclick = function() {
        document.querySelector('#open-input').click();
    };
    
    document.querySelector('#open-input').onchange = function(event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                textbox.value = e.target.result;
                calcStats();
                storeLocally();
                filenameBox.value = file.name;
            };
            reader.readAsText(file);
        }
    };

    // Popup functionality
    document.getElementById('readme-button').onclick = function() {
      document.getElementById('popup-overlay').style.display = 'block';
      document.getElementById('readme-popup').style.display = 'block';
      // Hide download notification if it was showing
      document.getElementById('download-notification').style.display = 'none';
    };
    
    document.getElementById('readme-close').onclick = function() {
      document.getElementById('popup-overlay').style.display = 'none';
      document.getElementById('readme-popup').style.display = 'none';
    };
    
    document.getElementById('popup-overlay').onclick = function() {
      document.getElementById('popup-overlay').style.display = 'none';
      document.getElementById('readme-popup').style.display = 'none';
    };
    
    // Check initial online status
    updateOnlineStatus();
    
    // Call adjustTextareaHeight initially
    setTimeout(adjustTextareaHeight, 100);
  </script>
</body>
</html>
