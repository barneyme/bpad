<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <link rel="stylesheet" href="mdstyle.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/2.1.3/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Markdown Editor</h1>
        <textarea id="markdown" placeholder="Write your markdown here..."></textarea>
        <div id="preview" class="preview"></div>
        <button id="saveTxt">Save as .md</button>
        <button id="savePdf">Save as .pdf</button>
    </div>

    <script>
        const textarea = document.getElementById('markdown');
        const preview = document.getElementById('preview');
        const saveTxtButton = document.getElementById('saveTxt');
        const savePdfButton = document.getElementById('savePdf');

        textarea.addEventListener('input', () => {
            const markdownText = textarea.value;
            preview.innerHTML = marked(markdownText);
        });

        // Save as .txt
        saveTxtButton.addEventListener('click', () => {
            const markdownText = textarea.value;
            const blob = new Blob([markdownText], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'bpad.md';
            link.click();
        });

        // Save as .pdf
        savePdfButton.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Use html2canvas to capture the preview div
            html2canvas(preview).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 190; // Set the width of the image
                const pageHeight = 295; // A4 page height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;

                let position = 0;

                // Add the image to the PDF
                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                doc.save('bpad.pdf');
            });
        });
    </script>
</body>
</html>
